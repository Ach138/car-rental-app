<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Car Rental App with Edit/Delete</title>
  <style>
    /* Keep your previous styles */
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h1 { text-align: center; }
    form { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 30px; max-width: 500px; margin: 0 auto 30px; }
    input { display: block; width: 100%; margin-top: 10px; padding: 10px; font-size: 1em; }
    button { margin-top: 15px; padding: 10px; font-size: 1em; background: #28a745; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    .car-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
    .car-card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.1); text-align: center; }
    .car-card img { max-width: 100%; height: 150px; object-fit: cover; margin-bottom: 10px; border-radius: 4px; }
    .btn-edit, .btn-delete {
      padding: 5px 10px;
      margin: 5px 3px 0 3px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
    }
    .btn-edit { background-color: #007bff; color: white; }
    .btn-delete { background-color: #dc3545; color: white; }
  </style>
</head>
<body>

  <h1>Car Rental App with Edit/Delete</h1>

  <form id="carForm">
    <input type="hidden" id="carId" />
    <input type="text" id="model" placeholder="Car Model" required />
    <input type="number" id="price" placeholder="Price per day" required />
    <input type="url" id="image" placeholder="Image URL" required />
    <button type="submit">Add Car</button>
    <button type="button" id="cancelEdit" style="display:none; margin-top:10px;">Cancel Edit</button>
  </form>

  <div class="car-list" id="carList"></div>

<script>
  const API_URL = "https://sheetdb.io/api/v1/tncy860v09njn";
  const carForm = document.getElementById("carForm");
  const carList = document.getElementById("carList");
  const cancelEditBtn = document.getElementById("cancelEdit");

  // Load and display cars
  async function loadCars() {
    const res = await fetch(API_URL);
    const cars = await res.json();
    carList.innerHTML = "";
    cars.forEach(car => {
      const card = document.createElement("div");
      card.className = "car-card";
      card.innerHTML = `
        <img src="${car.ImageURL}" alt="${car.Model}" />
        <h3>${car.Model}</h3>
        <p>Price: $${car.Price}/day</p>
        <button class="btn-edit" data-id="${car.id}">Edit</button>
        <button class="btn-delete" data-id="${car.id}">Delete</button>
      `;
      carList.appendChild(card);
    });
  }

  // Add new car or update existing
  carForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const id = document.getElementById("carId").value;
    const model = document.getElementById("model").value;
    const price = document.getElementById("price").value;
    const image = document.getElementById("image").value;

    if (id) {
      // Update existing car (PUT)
      await fetch(`${API_URL}/id/${id}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data: { Model: model, Price: price, ImageURL: image } })
      });
      alert("Car updated!");
    } else {
      // Add new car (POST)
      await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ data: { Model: model, Price: price, ImageURL: image } })
      });
      alert("Car added!");
    }

    resetForm();
    loadCars();
  });

  // Reset form to empty, hide cancel button
  function resetForm() {
    carForm.reset();
    document.getElementById("carId").value = "";
    cancelEditBtn.style.display = "none";
    carForm.querySelector("button[type='submit']").textContent = "Add Car";
  }

  cancelEditBtn.addEventListener("click", resetForm);

  // Handle Edit and Delete buttons click
  carList.addEventListener("click", async (e) => {
    if (e.target.classList.contains("btn-edit")) {
      const id = e.target.dataset.id;
      // Fetch single car data
      const res = await fetch(`${API_URL}/id/${id}`);
      const carData = await res.json();
      const car = carData[0];
      // Fill form with car data
      document.getElementById("carId").value = id;
      document.getElementById("model").value = car.Model;
      document.getElementById("price").value = car.Price;
      document.getElementById("image").value = car.ImageURL;
      carForm.querySelector("button[type='submit']").textContent = "Update Car";
      cancelEditBtn.style.display = "inline-block";

    } else if (e.target.classList.contains("btn-delete")) {
      const id = e.target.dataset.id;
      if (confirm("Are you sure you want to delete this car?")) {
        await fetch(`${API_URL}/id/${id}`, {
          method: "DELETE"
        });
        alert("Car deleted!");
        loadCars();
      }
    }
  });

  // Load cars on page load
  loadCars();
</script>

</body>
</html>
